---
// ClassesMarquee.astro
// Smooth horizontal marquee of class cards with cursor-based interaction
---

<section class="classes-marquee bg-ivory py-24 md:py-32 overflow-hidden">
  <div class="container mx-auto px-4 md:px-6">
    <!-- Section Header -->
    <div class="text-center mb-12 md:mb-16">
      <p class="text-sm uppercase tracking-widest text-charcoal/60 mb-3 font-inter">
        Our Classes
      </p>
      <h2 class="text-4xl md:text-5xl lg:text-6xl font-playfair text-charcoal mb-4">
        Explore Our Learning Paths
      </h2>
      <p class="text-lg text-charcoal/70 font-inter max-w-2xl mx-auto">
        Discover traditional and contemporary learning experiences rooted in culture and creativity
      </p>
    </div>

    <!-- Marquee Track Container -->
    <div class="marquee-container relative" data-marquee>
      <!-- Navigation Buttons -->
      <button 
        class="nav-btn nav-btn-left absolute left-4 top-1/2 -translate-y-1/2 z-20 w-12 h-12 bg-white/90 backdrop-blur-sm rounded-full shadow-lg flex items-center justify-center opacity-0 transition-all duration-300 hover:bg-saffron hover:text-white focus:outline-none focus:ring-2 focus:ring-saffron"
        data-nav-left
        aria-label="Scroll left"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
      </button>
      
      <button 
        class="nav-btn nav-btn-right absolute right-4 top-1/2 -translate-y-1/2 z-20 w-12 h-12 bg-white/90 backdrop-blur-sm rounded-full shadow-lg flex items-center justify-center opacity-0 transition-all duration-300 hover:bg-saffron hover:text-white focus:outline-none focus:ring-2 focus:ring-saffron"
        data-nav-right
        aria-label="Scroll right"
      >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
        </svg>
      </button>

      <div class="marquee-track flex gap-6 will-change-transform" data-marquee-track>
        <!-- Class Cards - Duplicated for seamless loop -->
        <!-- First Set -->
        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/art1.jpg" 
              alt="Art class showcasing creative expression through traditional and modern forms"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Art</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Creative expression through traditional and modern art forms.
            </p>
            <a 
              href="/classes/art" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>

        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/art3.jpg" 
              alt="Dance class featuring classical and contemporary training"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Dance</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Classical and contemporary dance training rooted in tradition.
            </p>
            <a 
              href="/classes/dance" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>

        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/music3.jpg" 
              alt="Music class teaching vocal and instrumental traditions"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Music</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Vocal and instrumental music guided by raga and rhythm.
            </p>
            <a 
              href="/classes/music" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>

        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/spiritual activity2.avif" 
              alt="Spiritual activities building cultural values and awareness"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Spiritual Activities</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Cultural and spiritual practices that build values and awareness.
            </p>
            <a 
              href="/classes/spiritual-activities" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>

        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/yoga2.jpg" 
              alt="Yoga class for balance, strength, and mindful living"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Yoga</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Yoga for balance, strength, and mindful living.
            </p>
            <a 
              href="/classes/yoga" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>

        <!-- Second Set (Duplicate for seamless loop) -->
        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/art1.jpg" 
              alt="Art class showcasing creative expression through traditional and modern forms"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Art</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Creative expression through traditional and modern art forms.
            </p>
            <a 
              href="/classes/art" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>

        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/art3.jpg" 
              alt="Dance class featuring classical and contemporary training"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Dance</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Classical and contemporary dance training rooted in tradition.
            </p>
            <a 
              href="/classes/dance" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>

        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/music3.jpg" 
              alt="Music class teaching vocal and instrumental traditions"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Music</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Vocal and instrumental music guided by raga and rhythm.
            </p>
            <a 
              href="/classes/music" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>

        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/spiritual activity2.avif" 
              alt="Spiritual activities building cultural values and awareness"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Spiritual Activities</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Cultural and spiritual practices that build values and awareness.
            </p>
            <a 
              href="/classes/spiritual-activities" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>

        <div class="class-card flex-shrink-0 w-80 bg-white rounded-2xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:scale-[1.02]">
          <div class="aspect-[4/3] overflow-hidden">
            <img 
              src="/images/yoga2.jpg" 
              alt="Yoga class for balance, strength, and mindful living"
              class="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-playfair text-charcoal mb-2">Yoga</h3>
            <p class="text-charcoal/70 font-inter mb-4 leading-relaxed">
              Yoga for balance, strength, and mindful living.
            </p>
            <a 
              href="/classes/yoga" 
              class="learn-more-btn relative inline-block px-6 py-3 text-saffron font-inter font-medium rounded-lg overflow-hidden transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-saffron focus:ring-offset-2"
            >
              <span class="relative z-10">Learn More</span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Scroll Hint -->
    <p class="text-center text-sm text-charcoal/50 mt-8 md:hidden font-inter">
      Swipe to explore more classes
    </p>
  </div>
</section>

<script>
  import { gsap } from 'gsap';

  // Check for reduced motion preference
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (!prefersReducedMotion) {
    const marqueeContainer = document.querySelector('[data-marquee]') as HTMLElement;
    const marqueeTrack = document.querySelector('[data-marquee-track]') as HTMLElement;
    const navLeft = document.querySelector('[data-nav-left]') as HTMLElement;
    const navRight = document.querySelector('[data-nav-right]') as HTMLElement;

    if (marqueeContainer && marqueeTrack && navLeft && navRight) {
      // Motion state
      let baseSpeed = 0.5; // Base pixels per frame (slow and elegant)
      let currentSpeed = baseSpeed;
      let targetSpeed = baseSpeed;
      let isHovering = false;
      let mouseX = 0;
      let lastMouseX = 0;
      let mouseDeltaX = 0;
      let currentX = 0;

      // Get the width of one complete set of cards (5 cards)
      const cards = marqueeTrack.querySelectorAll('.class-card');
      const cardWidth = (cards[0] as HTMLElement).offsetWidth;
      const gap = 24; // 1.5rem = 24px
      const singleSetWidth = (cardWidth + gap) * 5; // 5 unique cards

      // Animation loop using GSAP ticker for smooth 60fps animation
      gsap.ticker.add(() => {
        // Smooth speed interpolation
        currentSpeed += (targetSpeed - currentSpeed) * 0.1;

        // Update position
        currentX -= currentSpeed;

        // Seamless loop: reset when first set has scrolled completely
        if (Math.abs(currentX) >= singleSetWidth) {
          currentX = 0;
        }

        // Apply transform
        gsap.set(marqueeTrack, {
          x: currentX,
        });
      });

      // Hover pause behavior
      marqueeContainer.addEventListener('mouseenter', () => {
        isHovering = true;
        targetSpeed = 0; // Pause smoothly
      });

      marqueeContainer.addEventListener('mouseleave', () => {
        isHovering = false;
        targetSpeed = baseSpeed; // Resume base speed
        mouseDeltaX = 0;
        
        // Hide both navigation buttons
        gsap.to([navLeft, navRight], {
          opacity: 0,
          duration: 0.3,
        });
      });

      // Cursor-based directional movement and navigation button visibility
      marqueeContainer.addEventListener('mousemove', (e) => {
        if (!isHovering) return;

        mouseX = e.clientX;
        mouseDeltaX = mouseX - lastMouseX;
        lastMouseX = mouseX;

        // Clamp delta to avoid jitter
        mouseDeltaX = Math.max(-10, Math.min(10, mouseDeltaX));

        // Influence speed based on cursor movement direction
        // Negative delta = moving left = scroll right (positive speed)
        // Positive delta = moving right = scroll left (negative speed)
        targetSpeed = -mouseDeltaX * 0.3;

        // Show navigation buttons based on cursor position
        const containerRect = marqueeContainer.getBoundingClientRect();
        const relativeX = e.clientX - containerRect.left;
        const containerWidth = containerRect.width;
        const midPoint = containerWidth / 2;

        if (relativeX < midPoint) {
          // Left half - show left button
          gsap.to(navLeft, { opacity: 1, duration: 0.3 });
          gsap.to(navRight, { opacity: 0, duration: 0.3 });
        } else {
          // Right half - show right button
          gsap.to(navRight, { opacity: 1, duration: 0.3 });
          gsap.to(navLeft, { opacity: 0, duration: 0.3 });
        }
      });

      // Reset last mouse position on mouse enter
      marqueeContainer.addEventListener('mouseenter', (e) => {
        lastMouseX = e.clientX;
      });

      // Navigation button click handlers
      navLeft.addEventListener('click', (e) => {
        e.preventDefault();
        
        // Scroll one card width to the right (positive direction)
        const scrollAmount = cardWidth + gap;
        const targetX = currentX + scrollAmount;
        
        gsap.to({ value: currentX }, {
          value: targetX,
          duration: 0.6,
          ease: 'power2.out',
          onUpdate: function() {
            currentX = this.targets()[0].value;
          }
        });
      });

      navRight.addEventListener('click', (e) => {
        e.preventDefault();
        
        // Scroll one card width to the left (negative direction)
        const scrollAmount = cardWidth + gap;
        const targetX = currentX - scrollAmount;
        
        gsap.to({ value: currentX }, {
          value: targetX,
          duration: 0.6,
          ease: 'power2.out',
          onUpdate: function() {
            currentX = this.targets()[0].value;
          }
        });
      });
    }
  } else {
    // Fallback for reduced motion: enable horizontal scroll
    const marqueeContainer = document.querySelector('[data-marquee]') as HTMLElement;
    if (marqueeContainer) {
      marqueeContainer.style.overflowX = 'auto';
      marqueeContainer.style.scrollSnapType = 'x mandatory';
      
      const cards = marqueeContainer.querySelectorAll('.class-card');
      cards.forEach((card) => {
        (card as HTMLElement).style.scrollSnapAlign = 'start';
      });

      // Hide navigation buttons in reduced motion mode
      const navButtons = marqueeContainer.querySelectorAll('.nav-btn');
      navButtons.forEach((btn) => {
        (btn as HTMLElement).style.display = 'none';
      });
    }
  }
</script>

<style>
  /* Learn More button - Top to bottom fill animation */
  .learn-more-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 0;
    background: linear-gradient(180deg, #D97706 0%, #B45309 100%);
    transition: height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 0;
    border-radius: 0.5rem;
  }

  .learn-more-btn:hover::before {
    height: 100%;
  }

  .learn-more-btn:hover {
    color: white;
  }

  /* Navigation buttons */
  .nav-btn {
    cursor: pointer;
    pointer-events: auto;
  }

  .nav-btn:active {
    transform: translateY(-50%) scale(0.95);
  }

  /* Smooth scrolling for mobile */
  @media (max-width: 768px) {
    .marquee-container {
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none; /* Firefox */
    }

    .marquee-container::-webkit-scrollbar {
      display: none; /* Chrome, Safari */
    }

    .class-card {
      scroll-snap-align: start;
    }

    /* Hide navigation buttons on mobile */
    .nav-btn {
      display: none;
    }
  }

  /* Ensure smooth transforms */
  .marquee-track {
    will-change: transform;
  }

  /* Prevent text selection during drag */
  .marquee-container {
    user-select: none;
    -webkit-user-select: none;
  }
</style>
